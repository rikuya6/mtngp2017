$(document).ready(function() {
  enchant();
  main();
});

var screen_width = 1152; //ゲーム画面の幅
var screen_height = 640; //ゲーム画面の高さ
var tex_width = screen_width - 80; //ノベルテキストエリアの幅
var tex_heigth = 200; //ノベルテキストエリアの高さ

function main(){
  let getCimg = function () {
    // キャラクター画像の準備
    let cimg = [];
    cimg[0] = false;
    for (let i = 1; i <= 13; i++) {
      cimg[i] = new Sprite(595, 842);
      cimg[i].image = this.game.assets["novel/" + i + ".png"];
      if (i == 1 || i == 5 || i == 9 || i == 13) {
        cimg[i].moveTo(100, -100);
      } else {
        cimg[i].moveTo(400, -100);
      }
    }
    return cimg;
  };

  // デフォルトテキスト：どこにも寄らずにゴールに到着した場合
  let noveltext = [
    'あずき',
    '「なにも買わずに　来ちゃった！',
    '　バス乗っちゃおーっと！」',
    13,
    104,
    false,
    false,
  ];

  let flower = [
    'あずき',
    '「よし　決めた！」',
    13,
    101,
    false,
    '<br><br>',
    '行き方を決めたあずきは　地図を片手に　歩き出しました。',
    'そして　バス停に向かう途中で　花屋さんの前を　通りかかりました。',
    105,
    false,
    'あずき',
    '「あ、　お花屋さん！　おばあちゃん何色が　好きだったかな…？」',
    -13,
    1,
    false,
    '<br><br>',
    '　・',
    '　・',
    '　・',
    '　・',
    110,
    -1,
    false,
    'あずき',
    '「よかった、ちゃんとお花も買えたし、あとは',
    '　バス停に向かって　歩くだけだね」',
    105,
    13,
    false,
    '<br><br>',
    'あずきは　今さっき買ったばかりの　花束を大事に持って',
    '歩いて行きました。',
    'そして　無事に　バス停まで　向かうことが　できました。',
    -13,
    false,
    'あずき',
    '「乗る予定のバスよりも　余裕を持って　着いちゃった！」',
    13,
    104,
    false,
    '<br><br>',
    'あずきが　バス停に着いてから　１０分後、',
    '乗る予定のバスが　到着しました。',
    false,
    false
  ];

  let park = [
    'あずき',
    '「よし　決めた！」',
    13,
    101,
    false,
    '<br><br>',
    '行き方を決めたあずきは　地図を片手に　歩き出しました。',
    'そしてバス停に　向かう途中で　あずきは　公園の前を',
    '通りかかりました。',
    -13,
    1,
    106,
    false,
    '？',
    '「あずき！」',
    false,
    'あずき',
    '「あ、きなこちゃん！　どうしたの？」',
    4,
    false,
    'きなこ',
    '「あずき、どこ行くの？　遊ばないの？」',
    false,
    'あずき',
    '「これからおばあちゃんのところに　お見舞いに行くところなの」',
    -1,
    13,
    false,
    'きなこ',
    '「えーそうなの？　ちょっと遊んでからにしようよ！',
    '　今から鬼ごっこするのに、こないの？」',
    -13,
    1,
    false,
    'あずき',
    '「うーん…　じゃあちょっとだけ…」',
    -1,
    9,
    false,
    '<br><br>',
    'あずきは　遊びに誘われて　公園に向かいました。',
    false,
    'あずき',
    '「お花屋さんは　後で向かえば　いいよね」',
    -9,
    1,
    false,
    '<br><br>',
    'そう考えて　あずきは　お見舞いのお花を　買うことを',
    '後回しにしました。',
    false,
    '<br><br>',
    '　・',
    '　・',
    '　・',
    '　・',
    -1,
    -4,
    110,
    false,
    'あずき',
    '「あ、もうこんな時間！　私そろそろ行くね！」',
    106,
    9,
    4,
    false,
    'きなこ',
    '「そっか　もう行っちゃうの？　また学校でね！」',
    false,
    '<br><br>',
    'あずきは　まだ遊んでいたい　気持ちを抑えて',
    '花屋さんに　向かいました。',
    -4,
    1,
    false,
    110,
    '<br><br>',
    '　・',
    '　・',
    '　・',
    '　・',
    -1,
    -9,
    false,
    '<br><br>',
    'あずきが　花屋さんの前を　通りかかった　時のことです。',
    105,
    1,
    false,
    'あずき',
    '「あれ？　もしかして、花屋さん　やってないのかな…？」',
    -1,
    9,
    false,
    '<br><br>',
    'お店の　入り口は　締め切られ、入れなくなっていました。',
    false,
    'あずき',
    '「どうしよう…　でもお花屋さんなんて ここしかないし、',
    '　ここで待ってても バスに 乗り遅れちゃうよね…」',
    110,
    -9,
    5,
    false,
    '<br><br>',
    'そういうと あずきは 花屋さんで花を買うのを 諦めることにしました。',
    false,
    'あずき',
    '「お母さんも 買えたらでいいって　言ってたし、',
    '　お花の　代わりになるものが　これから見つかるよね」',
    false,
    '<br><br>',
    'あずきが　バス停に着くと　丁度乗る予定の　バスが着きました。',
    false,
    false
  ];

  let library = [
    'あずき',
    '「よし　決めた！」',
    13,
    101,
    false,
    '<br><br>',
    '行き方を決めたあずきは　地図を片手に　歩き出しました。',
    'そしてバス停に　向かう途中で　あずきは　図書館を　見つけました。',
    '実はあずきは　本を読むのが　大好きなのです。',
    -13,
    1,
    107,
    false,
    'あずき',
    '「図書館だ！」',
    -1,
    13,
    false,
    '<br><br>',
    'あずきは　新しい本を探しに　図書館の中へ　向かっていきます。',
    false,
    'あずき',
    '「まだ時間あるし、ちょっと　くらいなら　寄ってもいいよね…」',
    -13,
    1,
    false,
    '<br><br>',
    '　・',
    '　・',
    '　・',
    '　・',
    110,
    -1,
    false,
    'あずき',
    '「え！　もう　こんな時間だ！」',
    107,
    5,
    false,
    '<br><br>',
    'あずきが　本来乗ろうとしていたバスが来る時間は',
    'とっくに　過ぎていました。',
    false,
    'あずき',
    '「大変！　いそがないと！」',
    false,
    '<br><br>',
    'あずきは　急いでバス停まで　向かいます。',
    false,
    '<br><br>',
    '　・',
    '　・',
    '　・',
    '　・',
    110,
    -5,
    false,
    '<br><br>',
    'そこに　タイミング良く　病院に向かうバスが　やってきました。',
    104,
    false,
    'あずき',
    '「よかった、あのバスに乗って行けば　まだ間に合うよね」',
    1,
    false,
    false
  ];

  // Cookieフラグ管理
  let status = Cookies.getJSON('status');
  console.log(status);
  if (status.flower_flg && !(status.park_flg) && !(status.library_flg)) noveltext = flower;
  else {
    // if (status.flower_flg) noveltext = flower;
    if (status.park_flg) noveltext = park;
    if (status.library_flg) noveltext = library;
  }

  new Novel(noveltext, getCimg, "stage2_novel");
}
